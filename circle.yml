machine:
  services:
    - docker

test:
  pre:
    # Stop services we don't care about, they just use up RAM
    - sudo service mysql stop
    - sudo service couchdb stop
    - sudo service memcached stop
    - sudo service mongodb stop
    - sudo service postgresql stop
    - sudo service rabbitmq-server stop
    - sudo service redis-server stop
    - sudo service zookeeper stop

    # Install Ansible
    - sudo apt-get install -y -q software-properties-common
    - sudo apt-add-repository -y ppa:ansible/ansible
    - sudo apt-get update -q
    - sudo apt-get install -y -q ansible

    - sudo ansible-galaxy install -r requirements.yml

  post:
    # Run playbook
    - ansible-playbook -vvv --extra-vars='{"provider":"vagrant", "default_host":"localhost", "system_user":"ubuntu", "system_group":"ubuntu"}' --skip-tags "loadbalancers" --connection=local hippo-provision.yml
