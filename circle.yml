test:
  pre:
    # Stop services we don't care about, they just use up RAM
    - sudo service mysql stop
    - sudo service couchdb stop
    - sudo service memcached stop
    - sudo service mongodb stop
    - sudo service postgresql stop
    - sudo service rabbitmq-server stop
    - sudo service redis-server stop
    - sudo service zookeeper stop

    # Install Ansible (development branch)
    - cd ..
    - git clone git://github.com/daniel-rhoades/ansible-environment
    - cd ansible-environment
    - bash bootstrap-development.sh
    - bash bootstrap-common.sh
    - cd ../hippo-provisioning-template

  post:
    # Run playbook
    - eval "$(./aws-ansible.sh $AWS_ACCESS_KEY_ID $AWS_SECRET_ACCESS_KEY $AWS_REGION)"
    - ansible-playbook provision-aws.yml -vvvv -e ssh_key_name=$ssh_key_name -e my_route53_zone=$my_route53_zone -e application_name=$CIRCLE_SHA1
    - ansible-playbook decommission-aws.yml -vvvv -e ssh_key_name=$ssh_key_name -e my_route53_zone=$my_route53_zone -e application_name=$CIRCLE_SHA1
